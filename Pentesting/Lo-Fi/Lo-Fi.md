---
layout: default
---
# Máquina Virtual: Cap
**Plataforma:** Try Hack Me  
**Categoría:** Pentesting Web, Local File Inclusion 
**Nivel de dificultad:** Fácil

---

## Información General
- **IP de la máquina:** `10.10.177.28`
- **Objetivo:** Capturar la bandera
- **Herramientas utilizadas:** Nmap, Burp Suite

---

##Resolución
El primer paso será determinar qué puertos están abiertos:

![Escaneo TCP](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Lo-Fi/Images/1.nmap.jpg)

Hay dos puertos abiertos: SSH (22/TCP) y HTTP (21/TCP). Al protocolo SSH no podremos acceder a menos que poseamos las credenciales del usuario, por lo que es peferible atacar ese puerto una vez tengamos cómo acceder.

Si buscamos en nuestro navegador la IP del objetivo, accederemos a una página web:

![HTTP](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Lo-Fi/Images/2.http.jpg)

Dentro de la página encontraremos una conocida entre los jóvenes, *The Lo-Fi Girl*.

La interfaz contiene links a secciones con distintos vídeos de youtube relacionados con la *Lo-Fi Girl*. Ninguno de estos vídeos tiene contenido, al igual que el motor de búsqueda de la página.

El programa que será de utilidad aquí, y el motivo por el que me parece interesante esta máquina virtual, es *Burp Suite.* *Burp Suite* es una herramienta útil en el mundo del *Pentesting*. Nos permite interceptar tráfico de una página web, y modificar la peticiones que ralizamos en ella.

Si pinchamos en cualquiera de los links de la página, estaremos haciendo una peticion GET. En este ejemplo, si pinchamos en "Relax", nuestra petición será *"GET /?page=relax"*. La táctica que se puede llevar a cabo es *Local File Inclusion*. 

*Local File Inclusion*, o FLI, consiste en explotar una vulnerabilidad que permite al atacante incluir archivos locales en el servidor mediante parámetros mal sanitizados. Y *?page=*, el parámetro que nos aparece en la petición, suele uno de ellos.

Por tanto, usamos *Burp Suite* para ejecutar un LFI:

![Burp Suite](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Lo-Fi/Images/3.burp.jpg)

La imagen muestra la interfaz de una de las funcionalidades de *Burp Suite*, el *Repeater*. Esta función nos permite modificar el mensaje y envíar peticiones las veces que necesitemos, mostrando en la pantalla contigua el script de la respuseta del servidor. Para mayor profundidad en el funcionamiento *Burp Suite*, y en especial en esta funcionalidad, recomiendo este [vídeo explicativo](https://www.youtube.com/watch?v=KT6McmK0FgA).

El objetivo ahora será encontrar algún archivo local interesante. Siempre es aconsejable intentar obtener el archivo */etc/passwd*, el cual contiene información de todos los usuarios del sistema. Por tanto, cambiamos la nueva petición a *"GET /?page=/../../../../etc/passwd"* (en caso de no funcionar, añade o borra "../").

![Burp Suite Repeater](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Lo-Fi/Images/4.burp_lfi.jpg)

Parece ser que ha funcionado. De momento, al no ir incluidas las respectivas contraseñas, el contenido el archivo es algo irrelevante. Pero, si se puede acceder a ese archivo local, se podrá acceder a otros. ¡Solo hay que pedirlo!

Para intentar encontrar otros archivos locales, es útil la herramienta de *Burp Suite* llamada *Intruder*. Esta herramienta nos permite *fuzzear* en base a las palabras que le indiquemos. También se pueden añadir listas, aunque, si no sabemos muy bien donde buscar y usamos listas predefinidas, recomiendo utilizar herramientas cono *Dirsearch* o *Wfuzz* que llevarán a cabo la tarea en menor tiempo. Dejo, para el que quiera profundizar más en la herramienta, este [vídeo](https://www.youtube.com/watch?v=qzvHvEhOs50), del mismo canal que el anterior.

Así pues, para este caso, introducimos directorios o direcciones que nos permitan obtener algún archivo de configuración o script relevante:

![Burp Suite Intruder](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Lo-Fi/Images/7.intruder_fail.jpg)

Parece no haber suerte. Pero, recordemos que si podemos extraer archivos locales, ¿quién dice que no podamos sacar directamente la *flag*?

![Burp Suite Flag](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Lo-Fi/Images/8.intruder_flag.jpg)

¡Parece que ha habido suerte! Aunque el status code sea 400 *(Bad Request)*, nos está indicando que, efectivamente, ahí se encuentra la bandera. El *Intruder* será de utilidad para obtener el archivo:

![Burp Suite Flag](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Lo-Fi/Images/9.flag.jpg)

Por tanto, como dije anteriormente, solo hay que pedirlo ;)


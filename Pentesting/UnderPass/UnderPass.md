---
layout: default
---
# Máquina Virtual: UnderPass
**Plataforma:** Hack The Box  
**Categoría:** Pentesting Web, Web Fuzzing, Escalada de Privilegios  
**Nivel de dificultad:** Fácil

---

## Información General
- **IP de la máquina:** `10.10.11.48`
- **Objetivo:** Obtener dos flags: user y root
- **Herramientas utilizadas:** Nmap, Gobuster, Dirsearch, etc.

---

### Escaneo de Puertos
Comenzamos con un escaneo de puertos TCP con nmap:

![Escaneo TCP](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/nmap.jpg)

De mismo modo, escanearemos los puertos UDP:

![Escaneo UDP](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/udp_nmap.jpg)

Tras los escaneos, se han abierto tres rutas: SSH (22/TCP), HTTP (80/TCP) y SNMP (161/UDP).

El protocolo SSH permite gestionar remotamente un servidor en Internet. Por lo que, si obtenemos las credenciales del cliente, podremos entrar a su servidor.

En este punto, lo único que se puede hacer es examinar si la versión que se esta usando tiene alguna vulnerabilidad conocida. Usaremos searchsploit:

![Searchsploit SSH](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/searchsploit.jpg)

La versión de SSH en uso es la 8.9, mientras que la versión más reciente de la que se conoce alguna vulnerabilidad es la 7.7. De momento, olvidémonos de este protocolo.

Antes de abordar el protocolo HTTP, veo recomendable echar un vistazo al SNMP. SNMP es un protocolo que permite administrar y monitorizar elementos dentro de una red. Si se examina, se puede extraer información importante sobre el usuario que nos puede ser útil para encarar el protocolo HTTP:

![snmpwalk](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/smnpwalk.jpg)

La herramienta *snmpwalk* "interroga" a los dispositivos SNMP y extrae información compartida. Básicamente, te permite "caminar" (*walk*) por los datos de un dispositivo SNMP. En este caso, se descubre que:
- Usa un sistema operativo Linux 5.15.0
- El usuario o correo con el que utiliza el protocolo es "steve@underpass.htb".
- El string "UnDerPass.htb is the only daloradius server in the basin!" aporta información importante. DaloRADIUS es una plataforma web que permite administrar servidores RADIUS, facilitando la gestión de usuarios, sesiones, autenticación, etc. Esto es, sin duda, una buena pista.

Por lo tanto, el tal *Steve* esta monitorizando un servidor web RADIUS mediante DaloRADIUS. Veámos dónde nos lleva su IP si realizamos una búsqueda:

![HTTP](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/daloradius.jpg)

Por lo visto, la dirección nos lleva a una página de inicio de sesión en DaloRADIUS. La página se llama *underpass.htb*, dominio que usa *Steve* en su dirección de correo. Al encontrarnos en una situación como esta, lo primero que debemos hacer es comprobar si las credenciales de acceso por defecto son válidas. En el caso de RADIUS son *administrator/radius*.

Las credenciales por defecto no han funcionado. Ahora, parece que podemos estar estancados. En caso de no saber qué hacer ante una página web, siempre es buena idea hacer *fuzzing*.

El *fuzzing* es una práctica basada en enviar datos aleatorios a un servicio, en este caso HTTP, para observar cómo responde y detectar posibles vulnerabilidades. Un ejemplo de *fuzzing* podría ser buscar "http://underpass.htb/users" y esperar la respuesta del servidor. Para llevarlo a cabo de forma masiva, en Kali Linux, se encuentra por defecto la herramienta Wfuzz, la cual, gracias a un listado de palabras comunes guardadas en un documento .txt, automatiza numerosos intentos de *fuzzing*. Sin embargo, recomiendo utilizar Dirsearch, una herramienta de Python con el mismo funcionamiento que Wfuzz que, bajo mi experiencia personal, es más eficiente y *fuzzea* más rápido.

![Dirsearch 1](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/dirsearch1.jpg)
![Dirsearch 2](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/dirsearch2.jpg)

En la primera captura de pantalla, la dirección web que se esta *fuzzeando* es http://underpas.htb/daloradius. Tras varios mensajes 403 (acceso prohibido), encontramos varias direcciones válidas 200 (acceso permitido) y 301 (movido permanentemente). En el que aparece la extensión */app* parece que puede haber algo interesante:

![Dirsearch 3](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/dirsearch4.jpg)
![Dirsearch 4](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/dirsearch3.jpg)

Tras *fuzzear*, se deja ver una página de login a la que podemos acceder, pero las credenciales por defecto tampoco funcionan aquí. Sin embargo, llama la atención que la extensión */operators* dé una respuesta 301. Sigamos con el *fuzzing*:

![Dirsearch 5](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/dirsearch5.jpg)

Parece que se permite el acceso a una nueva página de login. En esta, por fin, podemos acceder con las *default credentials*:

![Inside Daloradius](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/deloradius.jpg)

Al entrar a la interfaz se nos facilita el número de usuarios conectados: 1. Parece ser que está conectado un tal svcMosh, ¿*Steven*?

Al lado del nombre de usuario se encuentra una contraseña encriptada. Por su composión, todo apunta a que se trata de un hash MD5. Tras desencriptarlo en *crackstation.com* descubrimos la contraseña:

![Contraseña](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/contraseña.jpg)

Una vez se haya obtenido un nombre de usuario y una contraseña, el siguiente paso trivial será intentar usar esas credenciales para entrar al protocolo SSH:

![Inside SSH](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/ssh1.jpg)
![user.txt](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/usertxt1.jpg)
![User Flag](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/usertxt.jpg)

Ha funcionado. Estamos dentro. Y con nosotros se encuentra la User Flag. *But job's not finished*.

El siguiente paso es acceder al usuario root para capturar la Root Flag, solo accesible mediante una escalada de privilegios:

![Finding SUIDs](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/findsuid.jpg)

En primer comando de esta captura tiene como fin encotrar todos aquellos archivos que posean el bit SUID activado. Este bit nos indica que, mediante ese archivo, es posible realizar un *switch user* (cambio de usuario), lo que nos transportaría al usuario root.

En el segundo, "sudo -l" nos muestra los priviliegios *"sudoers"* a os que puede acceder el usuario. Aquí, los expertos en Hack The Box sabrán que en cualquier detalle dentro de la máquina se esconde una pista. Comparad el nombre de usuario con el protocolo al que nos deja acceder sin contraseña.

Así pues, podemos escalar privilegios mediante el protocolo MOSH. Este protocolo tiene la misma función que SSH: gestión remota, solo que de una forma más robusta y eficiente. En el comando siguiente, le estamos diciendo al protocolo MOSH que use *sudo* para ejecutar el binario *"mosh-server"* (lo que nos cambiaría al usuario root) en localhost, como nos indica *sudo -l*:

![Mosh Root 1](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/mosh.jpg)
![Inside Root Privileges](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/root.jpg)

Y ha funcionado. Hemos accedido al usuario root, desde el cual, podemos encontrar el objetivo.

![user.txt](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/UnderPass/Images/roottxt.jpg)

Con esta máquina virtual, inauguro mi repositorio personal de GitHub. Espero que os haya sido de utilidad y que, como yo, encontréis en el pentesting una buena experiencia. Nos vemos en la próxima!











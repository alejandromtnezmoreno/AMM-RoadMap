---
layout: default
---
[Volver al inicio](https://alejandromtnezmoreno.github.io/AMM-RoadMap/)
---
# Máquina Virtual: Cap
**Plataforma:** Hack The Box  
**Categoría:** Pentesting Web, Escalada de Privilegios  
**Nivel de dificultad:** Fácil

---

## Información General
- **IP de la máquina:** `10.10.10.245`
- **Objetivo:** Obtener dos flags: user y root
- **Herramientas utilizadas:** Nmap, Curl, TCPdump, etc.

---

## Resolución
El primer paso a realizar siempre será realizar un escaneo de puertos:

![Escaneo TCP](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/1.nmap_tcp.jpg)

Al añadir el parámetro "-sS" se ejecuta un escaneo sigiloso. Esto es debido a que, a diferencia de un *nmap* convencional, cuando nuestro ordenador recibe un *SYN-ACK* (indicativo de que el puerto está abierto), *nmap* envía directamente un *RST*, en vez un *ACK*. De este modo, no se establece comunicación completa y se dificulta nuestra identificación.

Rollos aparte, tenemos tres puertos abiertos. A los protocolos FTP (21/TCP) y SSH (22/TCP) no podemos acceder a menos que obtengamos credenciales. Siempre es bueno probar las *default credentials*, aunque en este caso no son válidas.

Por tanto, el siguiente paso será, desde el navegador, acceder a la página web correspondiente a la IP de la máquina:

![Dashboard](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/3.http.jpg)

La interfaz de la web es un dashboard de lo que parece ser un SIEM bastante simple. Tras explorar un poco por la página, me percaté de que los datos del apartado *"Security Snapshot"* iban variando cada vez que entraba. De hecho, incluso obtuve un *.pcap*, pero no contenía información relevante:

![Dashboard 1](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/4.dashboard.jpg)
![Dashboard 2](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/5.dashboard.jpg)
![TCPDump](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/7.tcpdump.jpg)

Mediante la herramienta *curl* investigué el link:

![Curl](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/6.curls.jpg)

Cada vez que alguien pinchara en el apartado *"Security Snapshot"*, la web redirigía a la dirección */data* cambiando los datos a mostrar en cada ocasión.

Esto significa que, si nos redirige a */data/12 y /data/13*, deberá existir un */data/0*:

![Dashboard 0](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/8.dashboard.jpg)

Efectivamente, al buscar *10.10.10.245/data/0* permite acceder a una captura de datos diferente. Abriendo el archivo *.pcap*, y leyendo rápidamente:

![Password](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/9.tcpdump_pass.jpg)

Se encuentran las credenciales de *Nathan*. Trivialmente, el siguiente paso será probarlas en los protocolos FTP y SSH:

![FTP](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/10.ftp_user.jpg)
![SSH](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/11.ssh_user_flag.jpg)

Las credenciales funcionan en ambos protocolos, y fácilmente se obtiene la *user flag*.

Solo falta acceder al usuario *root* para encontrar la *flag* que nos falta. Salta a la vista el archivo *"linpeas.1.sh"*. LinPEAS es un script que identifica configuraciones inseguras, vulnerabilidades, binarios SUID y todo aquel método que permite escalar privilegios. Parece que nos lo quieren poner en bandeja de plata.

![linPEAS](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/12.linpeas.jpg)

El archivo es bastante extenso, sin embargo, nos facilitan una leyenda en la que diferencia por colores los archivos más útiles a la hora de escalar privilegios. Quedémonos con que, si el archivo está escrito en rojo y subrayado de amarillo, tenemos un 95% de posibilidades de poder escalar privilegios mediante el mismo.

![linPEAS](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/13.linpeas_capabilities.jpg)

En el apartado capabilities encontramos un binario de *python* con la capacidad de hacer un SUID (Set User ID), lo permitiría cambiar al usuario *root*

En esta situación, debemos ir al directorio donde se encuentra el binario y ejecutar los siguientes comandos en python:

![Escalado de Privilegios](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/15.jpg)

Con el comando *"os.setuid(0)"*, cambiamos al usuario *root*, y con *"os.system("/bin/bash")"* obtenemos una *shell* como *root*, lo que nos permite un acceso total al sistema. Finalmente:

![Root Flag](https://alejandromtnezmoreno.github.io/AMM-RoadMap/Pentesting/Cap/Images/14.root_flag.jpg)


[Volver al inicio](https://alejandromtnezmoreno.github.io/AMM-RoadMap/)

